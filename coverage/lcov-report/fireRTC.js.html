<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for fireRTC.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="prettify.css" />
    <link rel="stylesheet" href="base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="index.html">All files</a> fireRTC.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">87.88% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>29/33</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">72% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>18/25</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">76.92% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>10/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.3% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>26/27</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import Peer from 'simple-peer';
&nbsp;
export default function createFireRTC({
                                        firebase, // firebase instance
                                        initiator, // whether you initiate the connection
                                        firebaseNameSpace, // optional firebase namespace
                                        peerConfig = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span> // further simple-peer configurations
                                        debug, // log debug outputs
                                        id, // peer id to identify the webRTC connection
                                        onError = <span class="fstat-no" title="function not covered" >()</span> =&gt; {}, // error callback
                                        onConnect = () =&gt; {}, // callback when connected
                                        onData = <span class="fstat-no" title="function not covered" >()</span> =&gt; {}, // callback when data was received
                                        onSignal = () =&gt; {} // callback when own signal is ready (from this point on you can join
                                      }) {
&nbsp;
  let ownSignal;
  const p = new Peer({ ...peerConfig, initiator, trickle: false });
&nbsp;
  p.on('error', <span class="fstat-no" title="function not covered" >fu</span>nction (err) { <span class="cstat-no" title="statement not covered" >console.error('error', err) </span>});
&nbsp;
  p.on('signal', function (signal) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (ownSignal) <span class="cstat-no" title="statement not covered" >return;</span>
    debug &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >console.log('SIGNAL', signal);</span>
    ownSignal = signal;
    join();
    onSignal(signal);
  });
&nbsp;
  p.on('connect', function () {
    debug &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >console.log('CONNECTED');</span>
    firebase.app(firebaseNameSpace).database().ref(`sdp/${id}`).remove();
    onConnect(p);
  });
&nbsp;
  p.on('data', function (data) {
    debug &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >console.log('data: ' + data);</span>
    onData(data);
  });
&nbsp;
  if(!initiator) listen();
&nbsp;
  function listen() {
    const relevantType = initiator ? 'answer' : 'offer';
    const sdpRef = firebase.app(firebaseNameSpace).database().ref(`sdp/${id}`);
    sdpRef.on('value', s =&gt; {
      <span class="missing-if-branch" title="else path not taken" >E</span>if(s.val() &amp;&amp; s.val()[relevantType]) p.signal(s.val()[relevantType]);
    });
  }
&nbsp;
  function join() {
    <span class="missing-if-branch" title="if path not taken" >I</span>if(!ownSignal) <span class="cstat-no" title="statement not covered" >throw new Error('join failed, due to missing signal');</span>
    if(initiator) listen();
    firebase.app(firebaseNameSpace).database().ref(`sdp/${id}/${ownSignal.type}`).set(ownSignal);
  }
&nbsp;
  function send(data) {
    try{
      p.send(data);
    } catch ( e) {
<span class="cstat-no" title="statement not covered" >      onError(e);</span>
    }
  }
&nbsp;
  return {
    send
  };
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sat Sep 22 2018 18:27:41 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="sorter.js"></script>
</body>
</html>
